var HOST=""+location.protocol+"//"+location.hostname+location.pathname;var beforeReportWriting=document.createEvent("beforeReportWriting"),afterReportWriting=document.createEvent("afterReportWriting");function reportTemplate(b,h,m,g,j,d,n,f,l,o){var k="";k="<article><h6><a href='?mode=get_comment_list&include_report=true&user="+h+"'>"+h+"</a> said on "+m+":</h6><div class='tools'>";if(!o){k+="<a href='?mode=get_comment&id="+b+"' data-id="+b+" class='go-button'> &gt; </a>"}k+="<a href='?mode=follow&id="+b+"' data-id="+b+" class='follow-button'> follow </a>";k+="<a href='?mode=like&id="+b+"' data-id="+b+" class='like-button'> like </a></div><p>";k+=g+"</p><span class='small'><a href="+l+" target='_blank' title=\""+l+'">'+(l.length>40?l.substr(0,40)+"...":l)+"</a> on "+f+"</a><span class='additional-information'>"+j+"."+d+" on "+n+"</span></article>";return k}function commentWriter(f,k){if(!f){return false}var m=JSON.parse(f),l="";for(g in m.list){a=m.list[g];l+=reportTemplate(a.id,a.username,a.date_time,a.report,a.Opera,a.build,a.OS,a.domain,a.page,true)}var b="<form action='' id='comment-form'>                 <input type='text' data-fid='system' id='OS' value=''>                 <input type='text' data-fid='version' id='opera-version'>                 <input type='text' data-fid='build' id='opera-build-number'>                 <input type='hidden' data-fid='language' id='language'>                 <textarea id='comment-text' data-fid='description' placeholder='Please enter your comment'></textarea>                 <textarea style='display:none' id='additional-information' data-fid='misc'></textarea>                 <button type='submit' data-fid='misc'>Send</button>               </form>";document.getElementsByTagName("section")[0].innerHTML=l+b;if(window.localStorage==null||(window.localStorage!=null&&localStorage.getItem("clientOS")==null)){sendRequest("GET",HOST+"ajax_request_handler.php?mode=get_OS",function(n){document.getElementById("OS").value=n;localStorage.setItem("clientOS",n)},null)}else{document.getElementById("OS").value=localStorage.getItem("clientOS")}document.getElementById("comment-form").addEventListener("submit",function(n){n.preventDefault();var o="";for(g=0,formElements=document.getElementById("comment-form").children;g<6;g++){o+="&"+formElements[g].dataset.fid+"="+formElements[g].value}sendRequest("GET",HOST+"ajax_request_handler.php?mode=write_a_comment&id="+m.id+o,function(p){if(p!="true"){alert(p)}else{if(window.history){sendRequest("GET",HOST+"ajax_request_handler.php?+"+history.state.query,commentWriter,null)}else{sendRequest("GET",HOST+"ajax_request_handler.php"+document.location.search,commentWriter,null)}alert("Your comment is sent")}},null)},false);if((window.opera)&&(opera.buildNumber)){document.getElementById("opera-version").value=opera.version();document.getElementById("opera-build-number").value=opera.buildNumber()}document.getElementById("language").value=navigator.userLanguage;var h="\r\n===========\r\n",d="";d+="PLUGINS:"+h;if(navigator.plugins){for(var g=0;g<navigator.plugins.length;g++){var j=navigator.plugins[g];d+="* "+j.name+" ("+j.description+") "+j.filename+"\r\n"}}d+="\n\nSCREEN:"+h;if((typeof(screen.width)!="undefined")&&(screen.width&&screen.height)){d+="Resolution: "+screen.width+"x"+screen.height+"\n"}if((typeof(screen.colorDepth)!="undefined")&&(screen.colorDepth)){d+="ColorDepth: "+screen.colorDepth+"\r\n"}document.getElementById("additional-information").innerHTML=d;if(!k){history.pushState({data:f,type:m.type,query:m.query,id:(m.id==undefined)?"":m.id,page:(m.page==undefined)?"1":m.page,user:(m.user==undefined)?"":m.user,domain:(m.domain==undefined)?"":m.domain,url:(m.url==undefined)?"":m.url,},"Comments",HOST+"?"+m.query)}}function reportWriter(g,h){if(!g){return false}var b=JSON.parse(g),d="";for(i in b.list){a=b.list[i];d+=reportTemplate(a.id,a.username,a.date_time,a.report,a.Opera,a.build,a.OS,a.domain,a.page,false)}if(b.page==1){prevLink=b.query;nextLink=b.query+"&page=2"}else{prevLink=b.query.replace("page="+b.page,"page="+(b.page-1));nextLink=b.query.replace("page="+b.page,"page="+(b.page+1))}d+="<a href='?"+prevLink+"' id='prev'>&lt;</a> <input type='number' onchange='go2page(this.value)' id='page' value='"+(b.page)+"'><a href='?"+nextLink+"' id='forw'>&gt;</a>";document.querySelector("section").innerHTML=d;if(!h){history.pushState({data:g,type:b.type,query:b.query,id:(b.id==undefined)?"":b.id,page:(b.page==undefined)?"1":b.page,user:(b.user==undefined)?"":b.user,domain:(b.domain==undefined)?"":b.domain,url:(b.url==undefined)?"":b.url,},"Reports",HOST+"?"+b.query)}var f=document.querySelectorAll(".go-button");for(c=0;c<f.length;c++){f[c].addEventListener("click",function(j){j.preventDefault();sendRequest("GET",HOST+"ajax_request_handler.php?mode=get_comment_list&id="+j.target.dataset.id,commentWriter,null);return false},false)}document.getElementById("prev").addEventListener("click",reportPaging,false);document.getElementById("forw").addEventListener("click",reportPaging,false);followThreatCommand()}window.addEventListener("popstate",function(b){if(b.state==null){return false}switch(b.state.type){case"comments":commentWriter(b.state.data,1);break;case"reports":reportWriter(b.state.data,1);break}},false);function goHomePage(){sendRequest("GET",HOST+"ajax_request_handler.php?mode=get_report_list",reportWriter,null)}if(location.search.length>1){if(location.search.search("get_report_list")>0){sendRequest("GET",HOST+"ajax_request_handler.php"+location.search,reportWriter,null)}else{if(location.search.search("get_comment_list")>0){sendRequest("GET",HOST+"ajax_request_handler.php"+location.search,commentWriter,null)}}}else{goHomePage()}window.addEventListener("DOMContentLoaded",function(){document.getElementById("form").addEventListener("submit",function(){event.preventDefault();var b="";if(document.getElementById("domain").value){b+="&domain="+document.getElementById("domain").value}sendRequest("GET",HOST+"ajax_request_handler.php?mode=get_report_list&search=1"+b,reportWriter,null);return false},false);document.querySelector("header h1 a").addEventListener("click",function(){event.preventDefault();goHomePage();return false},false);document.getElementById("most-popular-reports").addEventListener("click",function(b){b.preventDefault();sendRequest("GET",HOST+"ajax_request_handler.php?mode=get_report_list&order=popularity",reportWriter,null)},false);document.getElementById("most-followed-reports").addEventListener("click",function(b){b.preventDefault();sendRequest("GET",HOST+"ajax_request_handler.php?mode=get_report_list&order=most_followed",reportWriter,null)},false);document.getElementById("more-detail-about-project").addEventListener("click",function(d){var b=document.getElementById("explanation-about-the-extension");switch(b.style.height){case"":case"100px":b.style.height="auto";d.target.innerText="Less";b.className="";break;case"auto":b.style.height="100px";d.target.innerText="More";b.className="closed";break}},false)},false);function reportPaging(b){b.preventDefault();sendRequest("GET",HOST+"ajax_request_handler.php"+b.target.href.match(/\?.*/)[0],reportWriter,null)}function followThreatCommand(){var b=document.querySelectorAll(".follow-button");for(i=0;i<b.length;i++){b[i].addEventListener("click",function(d){d.preventDefault();sendRequest("GET",HOST+"ajax_request_handler.php?mode=follow&id="+e.target.dataset.id)},false)}}function sendRequest(l,f,k,j){var h=new XMLHttpRequest();document.getElementById("loading").style.display="block";h.onreadystatechange=function(){if(this.status==200&&this.readyState==4){if(typeof k=="function"){k(this.responseText)}document.getElementById("loading").style.display="none"}};if(typeof j=="object"&&j){var d="";for(i in j){if(typeof g=="undefined"){d+=i+"="+encodeURIComponent(j[i]);var g=true}else{d+="&"+i+"="+encodeURIComponent(j[i])}}}else{d=false}try{if(l.toLowerCase()!="get"){throw'Invalid method "'+l+'" was specified. AJAX request could not be completed.'}else{h.open(l,f+(d&&d.length?"?"+d:""),true);h.send(null)}}catch(b){console.log("Error: "+b);return false}};